<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MyHammerspoon Settings</title>
  <link href="settings_dialog/settings_dialog.css" rel="stylesheet">
  <script src="static/js/jquery-3.7.1.min.js"></script>

  <script src="static/js/mousetrap.min.js"></script>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/themes/nano.min.css"/>
  <script src="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/pickr.min.js"></script>
  <script src="settings_dialog/settings_dialog.js"></script>
</head>

<body>
  <div class="page-container">
    <div class="top-nav">
      <button id="save">Save</button>
    </div>
    <div class="settings-dialog-container">
      <div id="settings-dialog"></div>
    </div>
  </div>

  <script>
    function mk_control(control_type, value) {
      switch (control_type) {
        case "checkbox":
          return new CheckboxControl(value);
        case "number":
          return new NumberControl(value);
        case "color":
          return new ColorControl(value);
        case "hotkey":
          return new KeysListControl(value);
        default:
          console.error("Unknown control type: " + control_type);
          return;
      }
    }

    function mk_item(j_item, value) {
      return new SettingsItem(
        j_item.name,
        j_item.title,
        j_item.descr,
        mk_control(j_item.control, value)
      );
    }

    function mk_section(j_section, values) {
      return new Section(
        j_section.name,
        j_section.title,
        j_section.descr,
        j_section.items.map(j_item => { return mk_item(j_item, values[j_item.name]); })
      );
    }

    function mk_settings_dialog(j_sections, values) {
      return new SettingsDialog(
        "settings",
        $("#settings-dialog"),
        j_sections.map((j_section, index) => { return mk_section(j_section, values[index]); })
      );
    }

    if (typeof RUNNING_IN_HAMMERSPOON === "undefined") {
      RUNNING_IN_HAMMERSPOON = false;
      if (typeof CONFIG_SCHEMA !== "undefined")
        console.error("CONFIG_SCHEMA should not be defined when running in a browser.");
      if (typeof CONFIG_VALUESD !== "undefined")
        console.error("CONFIG_VALUES should not be defined when running in a browser.");
      CONFIG_SCHEMA = JSON.parse("[{\"name\":\"features\",\"items\":[{\"name\":\"dark_bg\",\"descr\":\"Dark Background\",\"control\":\"checkbox\"},{\"name\":\"find_mouse_cursor\",\"descr\":\"Find Mouse Cursor\",\"control\":\"checkbox\"},{\"name\":\"launch\",\"descr\":\"Launch\",\"control\":\"checkbox\"},{\"name\":\"viz_key_strokes\",\"descr\":\"Visualize Key Strokes\",\"control\":\"checkbox\"},{\"name\":\"viz_mouse_clicks\",\"descr\":\"Visualize Mouse Clicks\",\"control\":\"checkbox\"},{\"name\":\"win_kbd\",\"descr\":\"Window Keyboard\",\"control\":\"checkbox\"},{\"name\":\"win_mouse\",\"descr\":\"Win-Mouse\",\"control\":\"checkbox\"}],\"title\":\"Features\"},{\"title\":\"Dark Background\",\"items\":[{\"title\":\"Hotkey: Darker\",\"default\":[\"hyper\",\"-\"],\"descr\":\"Hotkey for making background darker.\",\"name\":\"hotkey_darker\",\"control\":\"hotkey\"},{\"title\":\"Hotkey: Lighter\",\"default\":[\"hyper\",\"=\"],\"descr\":\"Hotkey for making background lighter.\",\"name\":\"hotkey_lighter\",\"control\":\"hotkey\"}],\"name\":\"dark_bg\",\"descr\":\"Darken the screen background to reduce eye strain.\"},{\"title\":\"Find Mouse Cursor\",\"items\":[{\"title\":\"Hotkey\",\"default\":[\"ctrl\",\"cmd\",\"m\"],\"descr\":\"Hotkey for highlighting the mouse cursor.\",\"name\":\"hotkey\",\"control\":\"hotkey\"},{\"title\":\"Highlight Duration\",\"default\":3000,\"descr\":\"Duration of the highlight in milliseconds.\",\"name\":\"highlight_duration\",\"control\":\"number\"},{\"title\":\"Circle Radius\",\"default\":30,\"descr\":\"Radius of the highlight circle in pixels.\",\"name\":\"circle_radius\",\"control\":\"number\"},{\"title\":\"Stroke Width\",\"default\":5,\"descr\":\"Width of the circle's circumference in pixels.\",\"name\":\"stroke_width\",\"control\":\"number\"},{\"title\":\"Stroke Color\",\"default\":\"#ff0000\",\"descr\":\"Color of the circle's circumference.\",\"name\":\"stroke_color\",\"control\":\"color\"},{\"title\":\"Fill Color\",\"default\":\"#ff00004c\",\"descr\":\"Color of the circle's interior.\",\"name\":\"fill_color\",\"control\":\"color\"}],\"name\":\"find_mouse_cursor\",\"descr\":\"Highlight the mouse cursor for a short duration.\"},{\"title\":\"Visualize Key Strokes\",\"items\":[{\"control\":\"hotkey\",\"title\":\"Start Hotkey\",\"name\":\"start_hotkey\",\"descr\":\"Hotkey for starting the visualization.\"},{\"control\":\"hotkey\",\"title\":\"Stop Hotkey\",\"name\":\"stop_hotkey\",\"descr\":\"Hotkey for stopping the visualization.\"},{\"title\":\"Text Size\",\"default\":48,\"descr\":\"Size of the text in the banner.\",\"name\":\"text_size\",\"control\":\"number\"},{\"title\":\"Canvas Height\",\"default\":56,\"descr\":\"Height of the banner.\",\"name\":\"canvas_height\",\"control\":\"number\"},{\"title\":\"Vertical Margin\",\"default\":32,\"descr\":\"Margin between the banner and the bottom of the screen.\",\"name\":\"v_margin\",\"control\":\"number\"},{\"title\":\"Horizontal Padding\",\"default\":6,\"descr\":\"Padding on the left and right of the text in the banner.\",\"name\":\"h_padding\",\"control\":\"number\"},{\"title\":\"Fill Color\",\"default\":\"#ffffff4c\",\"descr\":\"Color of the banner.\",\"name\":\"fill_color\",\"control\":\"color\"}],\"name\":\"viz_key_strokes\",\"descr\":\"Visualize key presses with an on-screen banner.\"},{\"title\":\"Visualize Mouse Clicks\",\"items\":[{\"title\":\"Circle Radius\",\"default\":35,\"descr\":\"The radius of the circle drawn around the mouse cursor.\",\"name\":\"circle_radius\",\"control\":\"number\"},{\"title\":\"Stroke Width\",\"default\":2,\"descr\":\"The width of the circle's stroke.\",\"name\":\"stroke_width\",\"control\":\"number\"},{\"title\":\"Left Click Stroke Color\",\"default\":\"#ffff00\",\"descr\":\"The color of the circle's stroke when left-clicking.\",\"name\":\"left_click_stroke_color\",\"control\":\"color\"},{\"title\":\"Right Click Stroke Color\",\"default\":\"#ff00ff\",\"descr\":\"The color of the circle's stroke when right-clicking.\",\"name\":\"right_click_stroke_color\",\"control\":\"color\"},{\"title\":\"Animation Duration\",\"default\":225,\"descr\":\"The duration of the circle's animation when clicking, in milliseconds.\",\"name\":\"anim_duration\",\"control\":\"number\"}],\"name\":\"viz_mouse_clicks\",\"descr\":\"Visualize mouse clicks with a short animation around the mouse cursor.\"},{\"title\":\"Win-Mouse\",\"items\":[{\"title\":\"Resize only bottom-right corner\",\"default\":true,\"descr\":\"When enabled, resizing affects only the bottom-right corner.\",\"name\":\"resize_only_bottom_right\",\"control\":\"checkbox\"}],\"name\":\"win_mouse\",\"descr\":\"Control window positions and sizes with the mouse.\"}]");
      CONFIG_VALUES = JSON.parse("[{\"viz_key_strokes\":true,\"win_mouse\":true,\"dark_bg\":true,\"launch\":true,\"win_kbd\":true,\"viz_mouse_clicks\":true,\"find_mouse_cursor\":true},{\"hotkey_darker\":[\"hyper\",\"-\"],\"hotkey_lighter\":[\"hyper\",\"=\"]},{\"stroke_color\":\"#ff0000\",\"highlight_duration\":3000,\"fill_color\":\"#ff00004c\",\"stroke_width\":5,\"circle_radius\":30,\"hotkey\":[\"ctrl\",\"cmd\",\"m\"]},{\"h_padding\":6,\"fill_color\":\"#ffffff4c\",\"text_size\":48,\"v_margin\":32,\"canvas_height\":56},{\"left_click_stroke_color\":\"#ffff00\",\"stroke_width\":2,\"anim_duration\":225,\"right_click_stroke_color\":\"#ff00ff\",\"circle_radius\":35},{\"resize_only_bottom_right\":true}]");
    } else {
      if (!RUNNING_IN_HAMMERSPOON)
        console.error("RUNNING_IN_HAMMERSPOON should be defined and true when running in Hammerspoon.");
    }

    let dialog = mk_settings_dialog(CONFIG_SCHEMA, CONFIG_VALUES);

    function save() {
      let msg = dialog.value();
      if (RUNNING_IN_HAMMERSPOON) {
        webkit.messageHandlers.settings_dialog.postMessage(msg);
      } else {
        console.log(msg);
      }
    }
    $("#save").click(save);
  </script>

</body>
</html>
